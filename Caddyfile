#Global directives
{
  auto_https off 
}
{$DOMAIN_NAME} {
    # HTTPS options:
    # tls {$TLS_EMAIL}

    # Test HTTPS setup
    # tls {$TLS_EMAIL} {
    #   ca https://acme-staging-v02.api.letsencrypt.org/directory
    # }

    # Removing some headers for improved security:
    header {
        -Server
    }

    # Serves static files, should be the same as `STATIC_ROOT` setting:
    root * /var/www/django/
    file_server *
    # Serving dynamic requests:
    @dynamic {
        not path /static/* /media/* /mio*
    }
    reverse_proxy @dynamic django:8000 

    reverse_proxy /mio* minio:{$MINIO_PORT} 
    
    log {
      # format console 
      output stdout
      format filter {
        wrap console
        fields {
          request>remote_ip delete 
          request>remote_port delete 
          request>client_ip delete 
          request>headers delete ##maybe add that in future 
          bytes_read delete 
          duration delete 
          size delete 
          status delete 
          headers delete          
          resp_headers delete           
         }
      }   
    }
    # Allows to use `.gz` files when available:
    # encode gzip
}
{$DOMAIN_NAME}:700 {

  reverse_proxy minio:{$MINIO_PORT} 

  log {
    # format console 
    output stdout
    format filter {
      wrap console
      fields {
        request>remote_ip delete 
        request>remote_port delete 
        request>client_ip delete 
        request>headers delete ##maybe add that in future 
        bytes_read delete 
        duration delete 
        size delete 
        status delete 
        headers delete          
        resp_headers delete           
        }
    }   
  }
}